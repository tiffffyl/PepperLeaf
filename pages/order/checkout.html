<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Kit Subscription</title>
    <link rel="stylesheet" href="/styles/general-styles.css">
    <link rel="stylesheet" href="/styles/checkout.css">
</head>

<body>
    

    <div class="container">
        <div class="summary page active" id="summary">
            <!--Back to Order button-->
            <a class="back-btn desktop" href="/pages/order/steps.html">
                <img src="/Assets/icons/back-btn-brown.svg">
                <p>Back</p>
            </a>
            <h1 class="title">Checkout</h1>
            <div class="order-summary">
                <div class="summary-title-bar">
                    <h2 class="title sub">Summary</h2>
                    <div class="cost"></div>
                </div>
                <div class="shipping-info">
                    <h3>Shipping</h3>
                    <h3>FREE</h3>
                </div>
                
                <div class="meal-box">
                    <div class="meal-box-container">
                        <div class="meal-box-ridge"></div>
                        <div class="meal-box-bg">
                            <div class="summary-item-container" id="recipeContainer"></div>
                        </div>
                        <h3 class="meal-box-title">Meal box</h3>
                        <div class="price-container">
                            <p id="priceContainer"></p>
                        </div>
                        <button class="next-btn desktop confirm" onclick="validate()">Place Order</button>
                    </div>
                    <p class="terms-condition">* By clicking PLACE ORDER or Apple Pay you are purchasing a flexible subscription and will receive weekly deliveries which you can pause or cancel at any time. 
                        There is no minimum commitment beyond the first order you are placing. 
                        Pricing is based on your plan choices. You have read and agreed to our Terms and Conditions and Privacy Policy.</p>
                </div>
            </div>
            
            <!--Next section button-->
            <button class="next-btn summary-page mobile" onclick="nextPage()">Next</button>
        </div>
        
        <div class="delivery page" id="delivery">
            <!--Previous Page button-->
            <button class="back-btn mobile" onclick="prevPage()">
                <img src="/Assets/icons/back-btn-brown.svg">
                <p>Back</p>  
            </button>
            <h1 class="title">Checkout</h1>
            <div class="delivery-information">
                <form class="input-form" id="personalInfoForm">
                    <div class="top-container">
                        <div class="personal-information-fields">
                            <p class="field-title">Personal information:</p>
                            <div class="name-field">
                                <input class="firstname-input" type="text" id="firstName" name="firstName" placeholder="First Name* " required>
                                <input class="lastName-input" type="text" id="lastName" name="lastName" placeholder="Last Name* " required>
                            </div> 
                            <div class="contact-field">
                                <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Phone Number*" required>    
                                <input type="text" id="email" name="email" placeholder="Email*" required>
                            </div>
                        </div>
                        <div class="delivery-details-fields">
                            <p class="field-title">Delivery details:</p>
                            <div class="address-field">
                                <input class="address-input" type="text" id="address" name="address" placeholder="Address* " required>
                                <input class="town-input" type="text" id="town" name="town" placeholder="Town/City* " required>
                                <input class="postcode-input" type="text" id="postcode" name="postcode" placeholder="Postcode* " required>
                            </div> 
                        </div>
                    </div>
                </form>
            </div>
            <!--Next section button-->
            <button class="next-btn mobile" onclick="nextPage()">Next</button>
        </div>
        
        <div class="payment page" id="payment">
            <!--Previous Page button-->
            <button class="back-btn mobile" onclick="prevPage()">
                <img src="/Assets/icons/back-btn-brown.svg">
                <p>Back</p>  
            </button>
            <h1 class="title">Checkout</h1>
            <div class="payment-information">
                <p class="field-title">Payment Method:</p>
                <div class="payment-container">
                    <!--Payment Method slider bar-->
                    <div class="payment-method-slider">
                        <div class="slider-bg">
                            <label for="method1" class="active"><input type="radio" id="method1" name="paymentMethod" onclick="changePaymentMethod(1)" checked>Credit/Debit card</label>
                            <label for="method2"><input type="radio" id="method2" name="paymentMethod" onclick="changePaymentMethod(2)">Apple Pay</label>
                            <label for="method3"><input type="radio" id="method3" name="paymentMethod" onclick="changePaymentMethod(3)">Google Pay</label>
                            <label for="method4"><input type="radio" id="method4" name="paymentMethod" onclick="changePaymentMethod(4)">PayPal</label>
                        </div>
                    </div>
                    <!--Container for payment methods-->
                    <div class="payment-method-container">
                        <div class="payment-method" id="method1">
                            <form class="payment-form" id="paymentMethodForm">
                                <div class="card-input-field">
                                    <input class="payment-input cardholder-name" type="text" id="cardholder-name" name="cardholder-name" placeholder="Cardholder name" required>
                                    <input class="payment-input card-number" type="text" id="card-number" name="card-number" placeholder="Card Number" required maxlength="19" pattern="\d*">
                                    <div class="info-container">
                                        <input class="payment-input expiry" type="text" id="expiry" name="expiry" placeholder="Expiry Date (MM/YY)" required maxlength="5" pattern="\d{2}/\d{2}">
                                        <input class="payment-input cvv" type="text" id="cvv" name="cvv" placeholder="CVV" required maxlength="3" pattern="\d*">
                                    </div>
                                </div>
        
                                <div class="credit-card">
                                    <img class="card-img" src="/Assets/icons/credit-card.svg">
                                    <div class="input-display">
                                        <p class="input-display card-number bold"></p>
                                        <div class="info-container">
                                            <p class="input-display cardholder-name light"></p>
                                            <p class="input-display expiry light"></p>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="payment-method other" id="method2">
                            <p>Apple pay not available</p>
                        </div>
                        <div class="payment-method other" id="method3">
                            <p>Google pay not available</p>
                        </div>
                        <div class="payment-method other" id="method4">
                            <p>PayPal also not available :(</p>
                        </div>
                    </div>
                </div>
            </div>
            <!--Place Order button-->
            <button class="next-btn mobile confirm" onclick="validate()">Place Order</button>
        </div>
    </div>



    
</body>
    
    <script src="/js/state.js"></script> <!--Handles active state of elements-->
    <script type="module" src="/js/checkout.js"></script>
    <script>
        //Page/section selection
        let currentPage = 0;
        const pages = document.querySelectorAll('.page');

        function nextPage() {
            if (window.innerWidth < 768 && currentPage < pages.length - 1) {
                pages[currentPage].classList.remove('active');
                currentPage++;
                pages[currentPage].classList.add('active');
            } else if (window.innerWidth >= 768 && currentPage < pages.length - 1) {
                pages[currentPage].classList.remove('active');
                currentPage++;
                pages[currentPage].classList.add('active');
                pages[currentPage - 1].style.transform = 'translateX(-100%)';
            }
        }

        function prevPage() {
            if (window.innerWidth < 768 && currentPage > 0) {
                pages[currentPage].classList.remove('active');
                currentPage--;
                pages[currentPage].classList.add('active');
            } else if (window.innerWidth >= 768 && currentPage > 0) {
                pages[currentPage].classList.remove('active');
                currentPage--;
                pages[currentPage].classList.add('active');
                pages[currentPage + 1].style.transform = 'translateX(100%)';
            }
        }

        
        document.addEventListener("DOMContentLoaded", function() {
            // Initially, set the left position of the first method to 0 and others to 100%
            var methods = document.querySelectorAll('.payment-method');
            methods.forEach(function(method, index) {
                if (index === 0) {
                    method.style.left = '0';
                } else {
                    method.style.left = '100%';
                }
            });
        });

        function changePaymentMethod(methodIndex) {
            
            var labels = document.querySelectorAll('.payment-method-slider label');
            labels.forEach(function(label, index) {
                if (index + 1 === methodIndex) {
                    label.classList.add('active');
                } else {
                    label.classList.remove('active');
                }
            });

            
            var methods = document.querySelectorAll('.payment-method');
            methods.forEach(function(method, index) {
                if (index + 1 === methodIndex) {
                    method.style.left = '0';
                } else {
                    method.style.left = '100%';
                }
            });
        }

        function validate() {
            const personalInfoForm = document.getElementById('personalInfoForm');
            if(personalInfoForm.checkValidity() ){
                placeOrder();
            }else{
                alert('Please fill all required inputs');
            }
    
        }

        //Function to place the order
        function placeOrder() {
            //retrieve Input fields
            const cardNumberInput = document.getElementById('card-number');
            const cvvInput = document.getElementById('cvv');
            const expiryInput = document.getElementById('expiry');
            const cardholderNameInput = document.getElementById('cardholder-name');

            let cardNumber = cardNumberInput.value;
            cardNumber = cardNumber.replace(/\s/g, ""); //Removes the spaces in cardnumber input
            const cvv = cvvInput.value;
            const expiry = expiryInput.value;
            const cardholderName = cardholderNameInput.value;

            //validation creiteria for card number
            const validCardNumber = '0123456789012345';
            const validCVV = '123';
            const validExpiry = '12/24';
            const validCardholderName = cardholderName.trim().length > 0; // Just check if not empty

            
            //Check if all inputs are valid
            if (cardNumber=== validCardNumber && cvv === validCVV && expiry === validExpiry && validCardholderName) {
                //go to the success page
                window.location.href = '/pages/order/payment/payment-successful.html';
            } else {
                //go to unsuccessful page
                window.location.href = '/pages/order/payment/payment-unsuccessful.html';
            }
        }

    </script>
</html>
